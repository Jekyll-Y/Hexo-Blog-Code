---
title: å¹¶æŸ¥é›†
date: 2022-06-09 19:50:14
tags: 
- æ•°æ®ç»“æ„
- å¹¶æŸ¥é›†
cover: https://s2.loli.net/2022/07/14/nX8JgUjMlbRfw1W.jpg

categories :
- å­¦ä¹ ç¬”è®°

toc: true

---

æµ…è°ˆå¹¶æŸ¥é›†



<!-- more -->

## å¹¶æŸ¥é›†

å¹¶æŸ¥é›†ï¼ˆ~~å†°èŒ¶å§¬~~$Disjoint-Set$ï¼‰æ˜¯ä¸€ç§æ ‘å½¢çš„æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥å¤„ç†ä¸€äº›ä¸äº¤é›†çš„**åˆå¹¶**ä»¥åŠ**æŸ¥è¯¢**é—®é¢˜ã€‚ä¸»è¦ä¸ºä¸¤ç§æ“ä½œï¼š

**æŸ¥æ‰¾**ï¼ˆFindï¼‰ï¼šç¡®å®šæŸä¸ªå…ƒç´ å¤„äºå“ªä¸ªå­é›†ï¼›


**åˆå¹¶**ï¼ˆMergeï¼‰ï¼šå°†ä¸¤ä¸ªå­é›†åˆå¹¶æˆä¸€ä¸ªé›†åˆã€‚

![](https://oi-wiki.org/ds/images/disjoint-set.svg)

### åˆå§‹åŒ–

```cpp
void makeSet(int size) 
{
  for (int i = 0; i < size; i++) fa[i] = i;  // iå°±åœ¨å®ƒæœ¬èº«çš„é›†åˆé‡Œ
  return;
}
```

### æŸ¥æ‰¾

> é€šä¿—åœ°è®²ä¸€ä¸ªæ•…äº‹ï¼šå‡ ä¸ªå®¶æ—è¿›è¡Œå®´ä¼šï¼Œä½†æ˜¯å®¶æ—æ™®éé•¿å¯¿ï¼Œæ‰€ä»¥äººæ•°ä¼—å¤šã€‚ç”±äºé•¿æ—¶é—´çš„åˆ†ç¦»ä»¥åŠå¹´é¾„çš„å¢é•¿ï¼Œè¿™äº›äººé€æ¸å¿˜æ‰äº†è‡ªå·±çš„äº²äººï¼Œåªè®°å¾—è‡ªå·±çš„çˆ¸çˆ¸æ˜¯è°äº†ï¼Œè€Œæœ€é•¿è€…ï¼ˆç§°ä¸ºã€Œç¥–å…ˆã€ï¼‰çš„çˆ¶äº²å·²ç»å»ä¸–ï¼Œä»–åªçŸ¥é“è‡ªå·±æ˜¯ç¥–å…ˆã€‚ä¸ºäº†ç¡®å®šè‡ªå·±æ˜¯å“ªä¸ªå®¶æ—ï¼Œä»–ä»¬æƒ³å‡ºäº†ä¸€ä¸ªåŠæ³•ï¼Œåªè¦é—®è‡ªå·±çš„çˆ¸çˆ¸æ˜¯ä¸æ˜¯ç¥–å…ˆï¼Œä¸€å±‚ä¸€å±‚çš„å‘ä¸Šé—®ï¼Œç›´åˆ°é—®åˆ°ç¥–å…ˆã€‚å¦‚æœè¦åˆ¤æ–­ä¸¤äººæ˜¯å¦åœ¨åŒä¸€å®¶æ—ï¼Œåªè¦çœ‹ä¸¤äººçš„ç¥–å…ˆæ˜¯ä¸æ˜¯åŒä¸€äººå°±å¯ä»¥äº†ã€‚

åœ¨è¿™æ ·çš„æ€æƒ³ä¸‹ï¼Œå¹¶æŸ¥é›†çš„æŸ¥æ‰¾ç®—æ³•è¯ç”Ÿäº†ã€‚

![](https://oi-wiki.org/ds/images/disjoint-set-find.svg)

```c++
int fa[MAXN];  // è®°å½•æŸä¸ªäººçš„çˆ¸çˆ¸æ˜¯è°ï¼Œç‰¹åˆ«è§„å®šï¼Œç¥–å…ˆçš„çˆ¸çˆ¸æ˜¯ä»–è‡ªå·±
int find(int x) 
{
  // å¯»æ‰¾xçš„ç¥–å…ˆ
  if (fa[x] == x)  // å¦‚æœxæ˜¯ç¥–å…ˆåˆ™è¿”å›
    return x;
  else
    return find(fa[x]);  // å¦‚æœä¸æ˜¯åˆ™xçš„çˆ¸çˆ¸é—®xçš„çˆ·çˆ·
}
```

### è·¯å¾„å‹ç¼©

ä¸€å±‚ä¸€å±‚çš„æ‰¾çˆ¶äº²æ•ˆç‡å¤ªä½äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥**æŠŠåœ¨è·¯å¾„ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½ç›´æ¥è¿æ¥åˆ°æ ¹ä¸Š**ï¼Œè¿™å°±æ˜¯è·¯å¾„å‹ç¼©ã€‚

```c++
int find(int x) 
{
  if (x != fa[x])  // xä¸æ˜¯è‡ªèº«çš„çˆ¶äº²ï¼Œå³xä¸æ˜¯è¯¥é›†åˆçš„ä»£è¡¨
    fa[x] = find(fa[x]);  // æŸ¥æ‰¾xçš„ç¥–å…ˆç›´åˆ°æ‰¾åˆ°ä»£è¡¨,äºæ˜¯é¡ºæ‰‹è·¯å¾„å‹ç¼©
  return fa[x];
}
```

### åˆå¹¶

> å®´ä¼šä¸Šï¼Œä¸€ä¸ªå®¶æ—çš„ç¥–å…ˆçªç„¶å¯¹å¦ä¸€ä¸ªå®¶æ—è¯´ï¼šæˆ‘ä»¬ä¸¤ä¸ªå®¶æ—äº¤æƒ…è¿™ä¹ˆå¥½ï¼Œä¸å¦‚åˆæˆä¸€å®¶å¥½äº†ã€‚å¦ä¸€ä¸ªå®¶æ—ä¹Ÿæ¬£ç„¶æ¥å—äº†ã€‚

æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ï¼Œå¹¶ä¸åœ¨æ„ç¥–å…ˆç©¶ç«Ÿæ˜¯è°ï¼Œæ‰€ä»¥åªè¦å…¶ä¸­ä¸€ä¸ªç¥–å…ˆå˜æˆå¦ä¸€ä¸ªç¥–å…ˆçš„å„¿å­å°±å¯ä»¥äº†ã€‚

![](https://oi-wiki.org/ds/images/disjoint-set-merge.svg)

```c++
void MergeSet(int x, int y) 
{
  // x ä¸ y æ‰€åœ¨å®¶æ—åˆå¹¶
  x = find(x);
  y = find(y);
  fa[x] = y;  // æŠŠ x çš„ç¥–å…ˆå˜æˆ y çš„ç¥–å…ˆçš„å„¿å­
}
```

### å¯å‘å¼åˆå¹¶

(~~å¥‡æŠ€æ·«å·§~~)

åœ¨åˆå¹¶é›†åˆæ—¶ï¼Œæ— è®ºå°†å“ªä¸€ä¸ªé›†åˆè¿æ¥åˆ°å¦ä¸€ä¸ªé›†åˆçš„ä¸‹é¢ï¼Œéƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚ä½†ä¸åŒçš„è¿æ¥æ–¹æ³•å­˜åœ¨æ—¶é—´å¤æ‚åº¦çš„å·®å¼‚ã€‚

æ‰€ä»¥åˆå¹¶æ—¶åˆ©ç”¨ç‚¹æ•°å’Œæ·±åº¦çš„ä¼°ä»·å‡½æ•°æ¥é™ä½[æ—¶é—´å¤æ‚åº¦](https://www.luogu.com.cn/blog/Atalod/shi-jian-fu-za-du-shi-neng-fen-xi-qian-tan#)ã€‚

> â€œç§©â€ï¼šæ ‘çš„æ·±åº¦(æœªè·¯å¾„å‹ç¼©) / é›†åˆå¤§å° ã€‚å‡æ‘Šå¤æ‚åº¦ $O(logN)$ã€‚

```C++
//è®°å½•å¹¶åˆå§‹åŒ–å­æ ‘çš„å¤§å°ä¸º 1
void MergeSet(int x, int y) 
{
  int x=find(x), y=find(y);
  if (x==y) return;
  if (size[x] > size[y])  // ä¿è¯å°çš„åˆåˆ°å¤§çš„é‡Œ
    swap(x, y);
  fa[x] = y;
  size[y] += size[x];
}//æŒ‰å¤§å°åˆå¹¶

int depth[maxn];// æ·±åº¦
void MergeSet(int x, int y) 
{
  int x=find(x),y=find(y)
  if(depth[x]<depth[y])fa[x]=y;
  if(depth[x]>depth[y])fa[y]=x;
  if(depth[x]==depth[y])
  {
      depth[y]++;
      fa[x]=y;
   }// æ·±åº¦å°çš„åˆå¹¶åˆ°æ·±åº¦å¤§çš„é›†åˆé‡Œ
}//æŒ‰ç§©åˆå¹¶
```


> åŒæ—¶é‡‡ç”¨ â€œè·¯å¾„å‹ç¼©â€ å’Œ â€œæŒ‰ç§©åˆå¹¶â€ ä¼˜åŒ–çš„å¹¶æŸ¥é›†ï¼Œ æ¯æ¬¡Getæ“ä½œå¤æ‚åº¦å¯è¿›ä¸€æ­¥é™ä½åˆ°$O(Î±(N))$(ä¸€ä¸ªæ¯”å¯¹æ•°å‡½æ•°å¢é•¿è¿˜æ…¢çš„å‡½æ•°ï¼Œå¯¹äº$\forall N \leqslant 2^{2^{10^{19729}}}$ï¼Œéƒ½æœ‰$\alpha(N)<5$ï¼Œæ•…$\alpha(N)$ï¼Œå¯è¿‘ä¼¼çœ‹æˆä¸€ä¸ªå¸¸æ•°ï¼Œç”±è‘—åè®¡ç®—æœºç§‘å­¦å®¶R.E.Tarjanäº1975å¹´å‘è¡¨çš„è®ºæ–‡ä¸­ç»™å‡ºäº†è¯æ˜)ã€‚

### å¸¦æƒå¹¶æŸ¥é›†

å¹¶æŸ¥é›†å…¶å®å°±æ˜¯ä¸€ä¸ªæ£®æ—ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ ‘ä¸Šçš„æ¯æ¡è¾¹ä¸Šè®°å½•ä¸€ä¸ªæƒå€¼ï¼Œç»´æŠ¤ä¸€ä¸ªæ•°ç»„$d$,ç”¨$d[x]$ä¿å­˜èŠ‚ç‚¹$x$åˆ°çˆ¶èŠ‚ç‚¹$fa[x]$ä¹‹é—´çš„è¾¹æƒï¼Œåœ¨è·¯å¾„å‹ç¼©çš„åŒæ—¶ä¸æ–­æ›´æ–°$d$æ•°ç»„ã€‚

```c++
int find(int x)
{
  if(x==fa[x])return x;
  int root=find(fa[x]); // æ±‚é›†åˆä»£è¡¨
  d[x]+=d[fa[x]]; // è¾¹æƒæ±‚å’Œï¼Œç»´æŠ¤dæ•°ç»„
  return fa[x]=root; // è·¯å¾„å‹ç¼©
}
```

### å¹¶æŸ¥é›†çš„åº”ç”¨

- å¹¶æŸ¥é›†èƒ½åœ¨**ä¸€å¼ æ— å‘å›¾ä¸­ç»´æŠ¤èŠ‚ç‚¹ä¹‹é—´çš„è¿é€šæ€§**ï¼Œè¿™æ˜¯å¹¶æŸ¥é›†çš„ä¸€ä¸ªåŸºæœ¬ç”¨é€”ï¼Œå®é™…ä¸Šï¼Œ**å¹¶æŸ¥é›†å¯ä»¥åŠ¨æ€ç»´æŠ¤å…·æœ‰ä¼ é€’æ€§çš„å…³ç³»**ã€‚
- æœ€å°ç”Ÿæˆæ ‘ç®—æ³•ä¸­çš„$Kruskal$å’Œæœ€è¿‘å…¬å…±ç¥–å…ˆä¸­çš„$Tarjan$ç®—æ³•éƒ½æ˜¯åŸºäºå¹¶æŸ¥é›†çš„ç®—æ³•ã€‚

### ä¾‹é¢˜ğŸš€ï¸

- [luoguP1196 é“¶æ²³è‹±é›„ä¼ è¯´](https://www.luogu.com.cn/problem/P1196)

è¿™é“é¢˜å‘¢å°±æ˜¯ç”¨åˆ°äº†å¸¦æƒå¹¶æŸ¥é›†ï¼Œåœ¨æœ¬é¢˜ä¸­æˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸¤å·ç›¸é‚»çš„æˆ˜èˆ°ä¹‹é—´çš„æƒå€¼çœ‹ä¸º$1$ã€‚

ä¸¤å·æˆ˜èˆ°ä¹‹é—´çš„æˆ˜èˆ°æ•°ç›®ï¼Œå…¶å®å°±æ˜¯ç¬¬$i$å·æˆ˜èˆ°çš„æ·±åº¦ä¸ç¬¬$j$å·æˆ˜èˆ°çš„æ·±åº¦çš„å·®çš„ç»å¯¹å€¼-$1$ã€‚

å¹¶ä¸”æˆ‘ä»¬è¿˜éœ€è¦ç”¨ä¸€ä¸ª$size$æ•°ç»„å»å­˜æ¯ä¸ªé›†åˆçš„å¤§å°ï¼Œå»æ›´æ–°æ¯ä¸ªç‚¹çš„æ·±åº¦ã€‚

~~~cpp
#include<bits/stdc++.h>
using namespace std;
int T,f[30010],dep[30010],size[30010];
int find(int x)
{
    if(x==f[x])return x;
    int fn=find(f[x]);
    dep[x]+=dep[f[x]];// æ›´æ–°æƒå€¼
    return f[x]=fn;
}// æŸ¥æ‰¾é›†åˆä»£è¡¨
void Union(int x,int y)
{
    x=find(x);
    y=find(y);
    dep[x]+=size[y];
    f[x]=y;
    size[y]+=size[x];
    size[x]=0;// è¿™ä¸€åˆ—ä¸Šå·²ç»æ²¡æœ‰æˆ˜èˆ°
    return;
}// åˆå¹¶
int main()
{
    scanf("%d",&T);
    for(int i=1;i<=30000;i++)f[i]=i,size[i]=1;// åˆå§‹åŒ–æ¯ä¸ªé›†åˆçš„ä»£è¡¨ä¸ºè‡ªå·±ï¼Œæ¯ä¸€åˆ—ä¸Šåªæœ‰ä¸€è‰˜æˆ˜èˆ°
    while(T!=0)
    {
        T--;
        char a;int b,c;
        cin>>a>>b>>c;
        if(a=='M')Union(b,c);
        if(a=='C')
        {
            if(find(b)!=find(c))printf("-1\n");// ä¸åœ¨åŒä¸€åˆ—ï¼Œè¾“å‡º-1
            else
                printf("%d\n",abs(dep[b]-dep[c])-1);// è®¡ç®—æœ‰å¤šå°‘è‰˜æˆ˜èˆ°

        }
    }
    return 0;
}
~~~

- [luoguP2502 æ—…è¡Œ](https://www.luogu.com.cn/problem/P2502)

è¿™æ˜¯ä¸€é“æšä¸¾åŠ å¹¶æŸ¥é›†ï¼Œé¦–å…ˆæˆ‘ä»¬å¯ä»¥å…ˆæŠŠæ¯æ¡è¾¹æŒ‰é€Ÿåº¦ä»å¤§åˆ°å°æ’åºç„¶åå»æšä¸¾æœ€å¤§è¾¹å’Œæœ€å°è¾¹ï¼Œä½¿é€Ÿåº¦æ¯”æœ€å°ã€‚

æšä¸¾çš„åŒæ—¶ä¸æ–­åŠ è¾¹ï¼Œç”¨å¹¶æŸ¥é›†æ¥åˆ¤æ–­èµ·ç‚¹å’Œç»ˆç‚¹æ˜¯å¦è”é€š,è¾“å‡ºæ—¶ä¸è¦å¿˜è®°åˆ†å­åˆ†æ¯åŒé™¤æœ€å¤§å…¬å› æ•°ã€‚

~~~cpp
#include<bits/stdc++.h>
using namespace std;
const int maxm=5e3+10;
int n,m,s,t,f[510],xl,yl;
double Min=2147483647;
struct node{
    int u,v,c;
};// ç»“æ„ä½“å­˜è¾¹
node edge[maxm];
int _find(int x)
{
    if(x==f[x])return x;
    return f[x]=_find(f[x]);
}// æŸ¥æ‰¾é›†åˆä»£è¡¨
void _union(int x,int y)
{
    x=_find(x);
    y=_find(y);
    f[x]=y;
    return;
}// åˆå¹¶
int cmp(node x,node y)
{
    return x.c>y.c;
}// æ’åº
int gcd(int x,int y)
{
	if(y==0)return x;
	return gcd(y,x%y);
}// æ±‚æœ€å¤§å…¬å› æ•°ï¼Œè¾—è½¬ç›¸é™¤æ³•
int main()
{
    scanf("%d%d",&n,&m);
    for(int i=1;i<=n;i++)f[i]=i;
    for(int i=1;i<=m;i++)
    {
        scanf("%d%d%d",&edge[i].u,&edge[i].v,&edge[i].c);
        _union(edge[i].u,edge[i].v);
    }
    scanf("%d%d",&s,&t);
    if(_find(s)!=_find(t))
    {
        printf("IMPOSSIBLE");
        return 0;
    }// å¦‚æœæŠŠæ‰€æœ‰è¾¹åŠ å…¥åèµ·ç‚¹ç»ˆç‚¹ä¸è¿é€šï¼Œè¾“å‡ºIMPOSSIBLE
    sort(edge+1,edge+m+1,cmp);
    for(int i=1;i<=m;i++)// æšä¸¾æœ€å¤§è¾¹
    {
        for(int j=1;j<=n;j++)f[j]=j;
        for(int j=i;j<=m;j++)// æšä¸¾æœ€å°è¾¹
        {
            _union(edge[j].u,edge[j].v);
            if(_find(s)==_find(t))
            {
                double tim=(1.0*edge[i].c)/(1.0*edge[j].c);
                if(tim<Min)
                {
                    xl=edge[i].c;
                    yl=edge[j].c;
                    Min=tim;// æ‰¾æœ€å°é€Ÿåº¦æ¯”
                }
                break;
            }
        }
    }
    if(gcd(xl,yl)==yl)cout<<xl/yl;
    else cout<<xl/gcd(xl,yl)<<'/'<<yl/gcd(xl,yl);// è¾“å‡º
    return 0;
}
~~~

- [luoguP1955 ç¨‹åºè‡ªåŠ¨åˆ†æ](https://www.luogu.com.cn/problem/P1955)

é¢˜ç›®è¯»èµ·æ¥å¾ˆç®€å•ï¼Œåªéœ€è¦å…ˆç”¨å¹¶æŸ¥é›†å¤„ç†æ˜¯ç­‰äºçš„çº¦æŸæ¡ä»¶ï¼Œä¹‹ååœ¨å¤„ç†ä¸ç­‰äºçš„æ¡ä»¶ï¼Œå¦‚æœä¸ç­‰äºçš„ä¸¤ä¸ªæ•°åœ¨åŒä¸€è”é€šå—å°±è¾“å‡º$NO$ï¼Œå¦åˆ™è¾“å‡º$YES$ã€‚

ä½†æ˜¯æœ¬é¢˜çš„æ•°æ®èŒƒå›´è¿‡å¤§ï¼Œæ— æ³•æŠŠè¾“å…¥çš„$x$ä½œä¸ºæ•°ç»„ä¸‹æ ‡å­˜å‚¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨åˆ°ç¦»æ•£åŒ–ã€‚

~~~cpp
#include<bits/stdc++.h>
using namespace std;
const int maxn=1e6+10;
int t,f[maxn],book[maxn*2];
struct node{
    int a,b,e;
};
int Find(int x)
{
    if(x==f[x])return x;
    return f[x]=Find(f[x]);
}
void Union(int x,int y)
{
    x=Find(f[x]);
    y=Find(f[y]);
    f[x]=y;
    return;
}
int cmp(node x,node y)
{
    return x.e>y.e;
}
int main()
{
    scanf("%d",&t);
    while(t!=0)
    {
        t--;
        int n,tot=0;
        scanf("%d",&n);
        node p[maxn];
        for(int i=1;i<=n;i++)
        {
            scanf("%d%d%d",&p[i].a,&p[i].b,&p[i].e);
            book[++tot]=p[i].a;
            book[++tot]=p[i].b;
        }
        sort(book+1,book+tot+1);
        int indx=unique(book+1,book+tot+1)-book-1;
        for(int i=1;i<=n;i++)
        {
            p[i].a=lower_bound(book+1,book+indx+1,p[i].a)-book;
            p[i].b=lower_bound(book+1,book+indx+1,p[i].b)-book;
        }
        bool k=true;
        for(int i=1;i<=indx;i++)f[i]=i;
        sort(p+1,p+n+1,cmp);
        for(int i=1;i<=n;i++)
        {
            if(p[i].e==1)
                Union(p[i].a,p[i].b);
            else 
            {
                if(Find(p[i].a)==Find(p[i].b))
                {
                    cout<<"NO"<<endl;
                    k=false;
                    break;
                }
            }
        }
        if(k==true)cout<<"YES"<<endl;
    }
    return 0;
}
~~~

- [luoguP2024 é£Ÿç‰©é“¾](https://www.luogu.com.cn/problem/P2024)

è¿™æ˜¯ä¸€é“ç§ç±»å¹¶æŸ¥é›†ï¼Œéœ€è¦åˆ†ææ¸…æ¥š$A$ç§ç¾¤ï¼Œ$B$ç§ç¾¤ï¼Œ$C$ç§ç¾¤ä¹‹é—´çš„å…³ç³»ã€‚

é¦–å…ˆè¿™ä¸‰ä¸ªç§ç¾¤ä¹‹é—´çš„å…³ç³»åªæœ‰**åŒç±»**ã€**çŒç‰©**å’Œ**å¤©æ•Œ**ï¼Œè¿™ä¸‰ç§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¼€ä¸€ä¸ªä¸‰å€çš„å¹¶æŸ¥é›†ï¼Œ**ä¸€å€å­˜åŒç±»ï¼ŒäºŒå€å­˜çŒç‰©ï¼Œä¸‰å€å­˜å¤©æ•Œ**ï¼Œç„¶åä¸æ–­å»åˆ¤æ–­å°±å¥½äº†ï¼Œå…·ä½“çœ‹ä»£ç æ³¨é‡Šï¼ˆç”¨åˆ°äº†æ‹“å±•åŸŸçš„å¹¶æŸ¥é›†ï¼‰ã€‚

~~~cpp
#include<bits/stdc++.h>
using namespace std;
const int maxn=5e4+10;
int n,k,f[maxn*3],ans;
int Find(int x)
{
    if(x==f[x])return x;
    return f[x]=Find(f[x]);
}
void Union(int x,int y)
{
    f[Find(f[x])]=Find(f[y]);
    return;
}
int main()
{
    scanf("%d%d",&n,&k);
    for(int i=1;i<=n*3;i++)f[i]=i;
    for(int i=1;i<=k;i++)
    {
        int flag,x,y;
        scanf("%d%d%d",&flag,&x,&y);
        if(x>n||y>n)
        {
            ans++;continue;
        }// å¦‚æœä¸åœ¨å½“å‰é£Ÿç‰©é“¾èŒƒå›´å†…ï¼Œå°±æ˜¯å‡è¯
        if(flag==1)
        {
            if(Find(x+n)==Find(y)||Find(x+2*n)==Find(y))
            {
                ans++;continue;
            }// å¦‚æœxæ˜¯yçš„çŒç‰©æˆ–å¤©æ•Œï¼Œä¸ºå‡è¯
            Union(x,y);Union(x+n,y+n);Union(x+2*n,y+2*n);
            // å¦‚æœæ˜¯çœŸï¼Œxçš„åŒç±»å°±æ˜¯yçš„åŒç±»ï¼Œxçš„çŒç‰©å°±æ˜¯yçš„çŒç‰©ï¼Œxçš„å¤©æ•Œå°±æ˜¯yçš„å¤©æ•Œ
        }
        else 
        {
            if(x==y)
            {   
                ans++;continue;
            }
            if(Find(x)==Find(y)||Find(x)==Find(y+n))
            {
                ans++;continue;
            }// å¦‚æœxæ˜¯yçš„åŒç±»æˆ–çŒç‰©ä¸ºå‡è¯
            Union(x+n,y);Union(x+2*n,y+n);Union(x,y+2*n);
            // å¦‚æœä¸ºçœŸï¼Œxçš„çŒç‰©å°±æ˜¯yçš„åŒç±»ï¼Œxçš„å¤©æ•Œå°±æ˜¯yçš„çŒç‰©ï¼Œxçš„åŒç±»å°±æ˜¯yçš„å¤©æ•Œ
        }
    }
    printf("%d",ans);
    return 0;
}
~~~

- [luoguP1197 æ˜Ÿçƒå¤§æˆ˜](https://www.luogu.com.cn/problem/P1197)

å¦‚æœæˆ‘ä»¬æ­£ç€æŒ‰é¡ºåºå»æ‘§æ¯ï¼Œæ˜¾ç„¶åœ¨æ—¶é—´å¤æ‚åº¦ä¸Šä¸å…è®¸ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»ä½¿ç”¨é€†å‘æ€ç»´ï¼ŒæŠŠ**æ‘§æ¯æ”¹ä¸ºä¿®å»º**å†åˆ©ç”¨å¹¶æŸ¥é›†åˆ¤æ–­è”é€šæ€§å°±å¯ä»¥äº†ã€‚

~~~cpp
#include<bits/stdc++.h>
using namespace std;
const int maxn=4e5+10;
int n,k,m,b[maxn],B[maxn],f[maxn];
int tot,ans[maxn];
vector<int> mp[maxn];
int Find(int x)
{
    if(x==f[x])return x;
    return f[x]=Find(f[x]);
}
void Union(int x,int y)
{
    f[Find(f[x])]=Find(f[y]);
}
int main()
{
    cin>>n>>m;
    for(int i=1;i<=n;i++)f[i]=i;
    for(int i=1;i<=m;i++)
    {
        int x,y;cin>>x>>y;
        mp[x].push_back(y);
        mp[y].push_back(x);
    }// å­˜åŒå‘å›¾
    cin>>k;
    for(int i=1;i<=k;i++)
    {
        cin>>b[i];
        B[b[i]]=1;
    }// æ ‡è®°æ˜¯å¦è¢«æ‘§æ¯
    tot=n-k;// æ‘§æ¯åæœ‰å‡ ä¸ªè”é€šå—
    for(int i=1;i<=n;i++)
    {
        for(int j=0;j<mp[i].size();j++)
        {
            if(!B[i]&&!B[mp[i][j]]&&Find(i)!=Find(mp[i][j]))// å¦‚æœæ²¡æœ‰è¢«æ‘§æ¯åˆå¹¶
            {
                tot--;// æ¯å‡ä¸€æ¡è¾¹è”é€šå—-1
                Union(i,mp[i][j]);
            }
        }
    }// å»ºå¥½æ‘§æ¯åçš„è”é€šå—
    ans[k+1]=tot;
    for(int i=k;i>=1;i--)
    {
        tot++;B[b[i]]=0;// ä¿®å»º
        for(int j=0;j<mp[b[i]].size();j++)
        {
            if(!B[mp[b[i]][j]]&&Find(b[i])!=Find(mp[b[i]][j]))
            {
                tot--;
                Union(b[i],mp[b[i]][j]);
            }
        }
        ans[i]=tot;
    }
    for(int i=1;i<=k+1;i++)cout<<ans[i]<<endl;
    return 0;
}
~~~

### å¯æŒä¹…åŒ–å¹¶æŸ¥é›†

å¹¶æŸ¥é›†ä½œä¸ºä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œä¹Ÿæ˜¯æœ‰å¯æŒä¹…åŒ–ç‰ˆæœ¬çš„ã€‚

é¡¾åæ€ä¹‰ï¼Œå¯æŒä¹…åŒ–å¹¶æŸ¥é›†=å¯æŒä¹…åŒ–+å¹¶æŸ¥é›†=å¯æŒä¹…åŒ–æ•°ç»„+å¹¶æŸ¥é›†=ä¸»å¸­æ ‘\+å¹¶æŸ¥é›†ã€‚ğŸ‘€ï¸

é¦–å…ˆï¼Œå› ä¸ºéœ€è¦è®°å½•å†å²ç‰ˆæœ¬ï¼Œæ‰€ä»¥è·¯å¾„å‹ç¼©æ˜¾ç„¶æ˜¯ä¸èƒ½ç”¨çš„ï¼›

å…¶æ¬¡ï¼Œä¸ºäº†è®©å¹¶æŸ¥é›†çš„é«˜åº¦å°½é‡ä¿æŒå¹³è¡¡ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°**æŒ‰ç§©åˆå¹¶**ã€‚ï¼ˆå¦‚æœå¹¶æŸ¥é›†é€€åŒ–åˆ°ä¸€æ¡é“¾çš„æƒ…å†µä¸‹ï¼Œæ•ˆç‡ä¼šéå¸¸ä½ï¼‰

å¯æŒä¹…åŒ–å¹¶æŸ¥é›†çš„æ“ä½œæœ‰ä»¥ä¸‹å‡ ç§ï¼š

> - å›åˆ°å†å²ç‰ˆæœ¬ï¼ˆ~~æ¯•ç«Ÿæ˜¯å¯æŒä¹…åŒ–æ•°ç»„~~ï¼‰ï¼›
> - åˆå¹¶ï¼ˆ~~æ¯•ç«Ÿæ˜¯å¹¶æŸ¥é›†~~ï¼‰ï¼›
> - æŸ¥è¯¢ç¥–å…ˆã€‚

å¯¹äºç¬¬ä¸€ä¸ªæ“ä½œï¼š

~~~cpp
root[i]=root[k];
~~~

å¯¹äºç¬¬äºŒä¸ªæ“ä½œï¼šå…¶å®å°±æ˜¯æŒ‰ç§©åˆå¹¶ï¼›

å¯¹äºç¬¬ä¸‰ä¸ªæ“ä½œï¼šåœ¨å¯æŒç»­åŒ–æ•°ç»„ä¸­æŸ¥è¯¢ã€‚

**åˆå§‹å»ºæ ‘**

~~~cpp
int build(int l,int r)
{
    cnt++;int p=cnt;
    if(l==r)
    {
        t[p].fa=l;
        return p;
    }
    int mid=(l+r)>>1;
    t[p].ls=build(l,mid);
    t[p].rs=build(mid+1,r);
    return p;
}
~~~

**åˆå¹¶**

~~~cpp
int merge(int now,int l,int r,int fat,int son)
{
    cnt++;int p=cnt;
    t[p]=t[now];
    if(l==r)
    {
        t[p].fa=fat;
        return p;
    }
    int mid=(l+r)>>1;
    if(son<=mid)t[p].ls=merge(t[p].ls,l,mid,fat,son);
    else t[p].rs=merge(t[p].rs,mid+1,r,fat,son);
    return p;
}
~~~

**æŒ‰ç§©åˆå¹¶çš„ä¿®æ”¹æ·±åº¦**

~~~cpp
void add(int p,int l,int r,int x)
{
    if(l==r)
    {
        t[p].depth++;
        return;
    }
    int mid=(l+r)>>1;
    if(x<=mid)add(t[p].ls,l,mid,x);
    else add(t[p].rs,mid+1,r,x);
}
~~~

**å¾—åˆ°å…ƒç´ åœ¨å½“å‰ç‰ˆæœ¬çš„å…ƒç´ ç¼–å·**

~~~cpp
int get_indx(int p,int l,int r,int x)
{
    if(l==r)return p;
    int mid=(l+r)>>1;
    if(x<=mid)return get_indx(t[p].ls,l,mid,x);
    else return get_indx(t[p].rs,mid+1,r,x);
}
~~~

**æŸ¥è¯¢ç¥–å…ˆ**

~~~cpp
int find(int now,int x)
{
    int father=get_indx(now,1,n,x);
    if(x==t[father].fa)return father;
    return find(now,t[father].fa);
}
~~~

æœ€åæ”¾ä¸€ä¸‹å®Œæ•´ä»£ç å§ï¼ˆQWQï¼‰ã€‚

**code**

~~~cpp
#include<bits/stdc++.h>
using namespace std;
const int maxm=2e5+10;
int n,m,root[maxm],cnt;
struct TREE{
    int ls,rs,fa,depth;
}t[maxm<<5];
int build(int l,int r)
{
    cnt++;int p=cnt;
    if(l==r)
    {
        t[p].fa=l;
        return p;
    }
    int mid=(l+r)>>1;
    t[p].ls=build(l,mid);
    t[p].rs=build(mid+1,r);
    return p;
}
void add(int p,int l,int r,int x)
{
    if(l==r)
    {
        t[p].depth++;
        return;
    }
    int mid=(l+r)>>1;
    if(x<=mid)add(t[p].ls,l,mid,x);
    else add(t[p].rs,mid+1,r,x);
}
int get_indx(int p,int l,int r,int x)
{
    if(l==r)return p;
    int mid=(l+r)>>1;
    if(x<=mid)return get_indx(t[p].ls,l,mid,x);
    else return get_indx(t[p].rs,mid+1,r,x);
}
int find(int now,int x)
{
    int father=get_indx(now,1,n,x);
    if(x==t[father].fa)return father;
    return find(now,t[father].fa);
}
int merge(int now,int l,int r,int fat,int son)
{
    cnt++;int p=cnt;
    t[p]=t[now];
    if(l==r)
    {
        t[p].fa=fat;
        return p;
    }
    int mid=(l+r)>>1;
    if(son<=mid)t[p].ls=merge(t[p].ls,l,mid,fat,son);
    else t[p].rs=merge(t[p].rs,mid+1,r,fat,son);
    return p;
}
int main()
{
    scanf("%d%d",&n,&m);
    root[0]=build(1,n);
    for(int i=1;i<=m;i++)
    {
        int opt;scanf("%d",&opt);
        if(opt==1)
        {
            int a,b;scanf("%d%d",&a,&b);
            root[i]=root[i-1];
            int f1=find(root[i],a);
            int f2=find(root[i],b);
            if(t[f1].fa==t[f2].fa)continue;
            if(t[f1].depth>t[f2].depth)swap(f1,f2);
            root[i]=merge(root[i-1],1,n,t[f2].fa,t[f1].fa);
            if(t[f1].depth==t[f2].depth)add(root[i],1,n,t[f2].fa);
        }
        if(opt==2)
        {
            int k;scanf("%d",&k);
            root[i]=root[k];
        }
        if(opt==3)
        {
            int a,b;scanf("%d%d",&a,&b);
            root[i]=root[i-1];
            int f1=find(root[i],a);
            int f2=find(root[i],b);
            if(t[f1].fa==t[f2].fa)printf("1\n");
            else printf("0\n");
        }
    }
    return 0;
}
~~~

### æ‹“å±•â€”å¯æŒä¹…åŒ–å¸¦æƒå¹¶æŸ¥é›†

å¯æŒä¹…åŒ–å¹¶æŸ¥é›†+è¾¹å¸¦æƒï¼ˆé€ƒï¼‰ã€‚

æœ€åé™„ä¸Šæˆ‘çš„[é¢˜å•](https://www.luogu.com.cn/training/116259#information)ã€‚

##### å®Œç»“æ’’èŠ±~~ï¼ˆç»ˆäºå†™å®Œäº†ï¼‰ğŸ‰ï¸ ğŸ‰ï¸ ğŸ‰ï¸

##### PSï¼š

ï¼ˆä¸€äº›èµ„æ–™å’Œå›¾ä¾‹å‚è€ƒè‡ªOIwikiå’Œç®—æ³•ç«èµ›è¿›é˜¶æŒ‡å—QwQ~,ä¸å–œå‹¿å–·ï¼‰
